2026-01-09 13:48:27.400 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 13:48:28.263 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 13:48:28.682 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 13:48:28.687 +02:00 [INF] Hosting environment: Development
2026-01-09 13:48:28.691 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 13:48:30.260 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 13:48:30.837 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 602.071ms
2026-01-09 13:48:30.863 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 13:48:30.864 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 13:48:30.877 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 14.3949ms
2026-01-09 13:48:31.095 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 231.114ms
2026-01-09 13:48:31.175 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 13:48:31.216 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.538ms
2026-01-09 13:48:38.318 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Product - null null
2026-01-09 13:48:40.787 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 13:48:40.838 +02:00 [INF] Route matched with {action = "GetAll", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:48:42.677 +02:00 [INF] Fetching all products...
2026-01-09 13:48:47.506 +02:00 [INF] Executed DbCommand (186ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
2026-01-09 13:48:47.599 +02:00 [INF] Fetched 1 products.
2026-01-09 13:48:47.620 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.ProductDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 13:48:47.672 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone) in 6823.0493ms
2026-01-09 13:48:47.676 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 13:48:47.694 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Product - 200 null application/json; charset=utf-8 9375.5872ms
2026-01-09 13:50:50.432 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Product - application/json 126
2026-01-09 13:50:50.443 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.Create (AmazonClone)'
2026-01-09 13:50:50.463 +02:00 [INF] Route matched with {action = "Create", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(Bl.DTOs.CreateProductDto) on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:50:50.562 +02:00 [INF] Creating a new product: Iphone 15pro max ...
2026-01-09 13:50:51.160 +02:00 [INF] Executed DbCommand (245ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 13:50:51.172 +02:00 [ERR] Category with ID 2 does not exist.
2026-01-09 13:50:51.331 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.Create (AmazonClone) in 861.7796ms
2026-01-09 13:50:51.336 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.Create (AmazonClone)'
2026-01-09 13:50:51.347 +02:00 [ERR] An unhandled exception has occurred while executing the request.
System.Exception: Category with ID 2 does not exist.
   at Bl.Services.ProductService.CreateProductAsync(CreateProductDto dto) in D:\AmazonClone\Bl\Services\ProductService.cs:line 64
   at AmazonClone.API.Controllers.ProductController.Create(CreateProductDto dto) in D:\AmazonClone\AmazonClone\Controllers\ProductController.cs:line 47
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2026-01-09 13:50:51.441 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Product - 500 null text/plain; charset=utf-8 1009.4866ms
2026-01-09 13:51:10.482 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category - null null
2026-01-09 13:51:10.493 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone)'
2026-01-09 13:51:10.501 +02:00 [INF] Route matched with {action = "GetAll", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 13:51:10.552 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
2026-01-09 13:51:10.566 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.CategoryDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 13:51:10.576 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone) in 69.787ms
2026-01-09 13:51:10.581 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone)'
2026-01-09 13:51:10.584 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category - 200 null application/json; charset=utf-8 102.5265ms
2026-01-09 13:51:26.919 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Product - application/json 127
2026-01-09 13:51:26.939 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.Create (AmazonClone)'
2026-01-09 13:51:26.943 +02:00 [INF] Route matched with {action = "Create", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(Bl.DTOs.CreateProductDto) on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:51:26.961 +02:00 [INF] Creating a new product: Iphone 15pro max ...
2026-01-09 13:51:26.989 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 13:51:27.503 +02:00 [INF] Executed DbCommand (89ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Products] ([CategoryId], [CreatedAt], [Description], [Name], [Price], [Status], [StockQuantity])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);
2026-01-09 13:51:27.552 +02:00 [INF] Product created with ID 3.
2026-01-09 13:51:27.557 +02:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType1`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 13:51:27.594 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.Create (AmazonClone) in 641.9294ms
2026-01-09 13:51:27.598 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.Create (AmazonClone)'
2026-01-09 13:51:27.601 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Product - 201 null application/json; charset=utf-8 682.3363ms
2026-01-09 13:52:02.608 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Product - null null
2026-01-09 13:52:02.635 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 13:52:02.638 +02:00 [INF] Route matched with {action = "GetAll", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:52:02.645 +02:00 [INF] Fetching all products...
2026-01-09 13:52:02.659 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
2026-01-09 13:52:02.676 +02:00 [INF] Fetched 2 products.
2026-01-09 13:52:02.678 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.ProductDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 13:52:02.681 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone) in 37.4552ms
2026-01-09 13:52:02.684 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 13:52:02.687 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Product - 200 null application/json; charset=utf-8 78.6732ms
2026-01-09 13:52:26.279 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Product/4 - null null
2026-01-09 13:52:26.299 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.GetById (AmazonClone)'
2026-01-09 13:52:26.321 +02:00 [INF] Route matched with {action = "GetById", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:52:26.331 +02:00 [INF] Fetching product with ID 4...
2026-01-09 13:52:26.358 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 13:52:26.364 +02:00 [WRN] Product with ID 4 not found.
2026-01-09 13:52:26.368 +02:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 13:52:26.378 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.GetById (AmazonClone) in 52.3667ms
2026-01-09 13:52:26.381 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.GetById (AmazonClone)'
2026-01-09 13:52:26.384 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Product/4 - 404 null application/json; charset=utf-8 105.4097ms
2026-01-09 13:52:54.435 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Product/3 - null null
2026-01-09 13:52:54.460 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.GetById (AmazonClone)'
2026-01-09 13:52:54.466 +02:00 [INF] Route matched with {action = "GetById", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 13:52:54.484 +02:00 [INF] Fetching product with ID 3...
2026-01-09 13:52:54.506 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 13:52:54.517 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.ProductDto'.
2026-01-09 13:52:54.522 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.GetById (AmazonClone) in 39.7791ms
2026-01-09 13:52:54.526 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.GetById (AmazonClone)'
2026-01-09 13:52:54.532 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Product/3 - 200 null application/json; charset=utf-8 97.3109ms
2026-01-09 14:07:05.182 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 14:07:05.631 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 14:07:05.827 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 14:07:05.829 +02:00 [INF] Hosting environment: Development
2026-01-09 14:07:05.832 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 14:07:08.196 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 14:07:08.778 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 604.412ms
2026-01-09 14:07:08.794 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 14:07:08.796 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 14:07:08.825 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 28.8855ms
2026-01-09 14:07:08.899 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 105.7141ms
2026-01-09 14:07:08.962 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 14:07:08.998 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 35.2849ms
2026-01-09 14:07:19.403 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category - null null
2026-01-09 14:07:19.604 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone)'
2026-01-09 14:07:19.663 +02:00 [INF] Route matched with {action = "GetAll", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:07:20.377 +02:00 [INF] Fetching all categories...
2026-01-09 14:07:23.629 +02:00 [INF] Executed DbCommand (114ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
2026-01-09 14:07:23.744 +02:00 [INF] Fetched 4 categories.
2026-01-09 14:07:23.767 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.CategoryDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 14:07:23.811 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone) in 4135.3798ms
2026-01-09 14:07:23.817 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetAll (AmazonClone)'
2026-01-09 14:07:23.840 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category - 200 null application/json; charset=utf-8 4436.3112ms
2026-01-09 14:07:43.812 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category/10 - null null
2026-01-09 14:07:43.824 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:07:43.850 +02:00 [INF] Route matched with {action = "GetById", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:07:43.885 +02:00 [INF] Fetching category with ID 10...
2026-01-09 14:07:44.246 +02:00 [INF] Executed DbCommand (58ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 14:07:44.256 +02:00 [WRN] Category with ID 10 not found.
2026-01-09 14:07:44.261 +02:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 14:07:44.274 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone) in 419.4617ms
2026-01-09 14:07:44.278 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:07:44.282 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category/10 - 404 null application/json; charset=utf-8 469.5613ms
2026-01-09 14:07:57.462 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category/26 - null null
2026-01-09 14:07:57.473 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:07:57.478 +02:00 [INF] Route matched with {action = "GetById", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:07:57.490 +02:00 [INF] Fetching category with ID 26...
2026-01-09 14:07:57.539 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 14:07:57.546 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CategoryDto'.
2026-01-09 14:07:57.551 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone) in 68.8134ms
2026-01-09 14:07:57.554 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:07:57.558 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category/26 - 200 null application/json; charset=utf-8 96.1612ms
2026-01-09 14:08:45.389 +02:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5114/api/Category/26 - application/json 117
2026-01-09 14:08:45.397 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.Update (AmazonClone)'
2026-01-09 14:08:45.408 +02:00 [INF] Route matched with {action = "Update", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Update(Int32, Bl.DTOs.CategoryDto) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:08:45.476 +02:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 14:08:45.481 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.Update (AmazonClone) in 66.7388ms
2026-01-09 14:08:45.485 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.Update (AmazonClone)'
2026-01-09 14:08:45.488 +02:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5114/api/Category/26 - 400 null application/json; charset=utf-8 98.4218ms
2026-01-09 14:09:33.137 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json - null null
2026-01-09 14:09:33.153 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json - 404 0 null 18.0954ms
2026-01-09 14:09:33.167 +02:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2026-01-09 14:09:53.812 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category/26 - null null
2026-01-09 14:09:53.818 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:09:53.822 +02:00 [INF] Route matched with {action = "GetById", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:09:53.827 +02:00 [INF] Fetching category with ID 26...
2026-01-09 14:09:53.841 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 14:09:53.855 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CategoryDto'.
2026-01-09 14:09:53.858 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone) in 31.4422ms
2026-01-09 14:09:53.862 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:09:53.865 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category/26 - 200 null application/json; charset=utf-8 52.801ms
2026-01-09 14:10:06.957 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/3 - null null
2026-01-09 14:10:06.969 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 14:10:06.977 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 14:10:06.986 +02:00 [INF] Fetching cart for user 3.
2026-01-09 14:10:07.428 +02:00 [INF] Executed DbCommand (54ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 14:10:07.435 +02:00 [INF] Creating new cart for user 3.
2026-01-09 14:10:07.827 +02:00 [INF] Executed DbCommand (47ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 14:10:07.904 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:cbc8c506-f50f-4796-8080-0424a3aa95de
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:cbc8c506-f50f-4796-8080-0424a3aa95de
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 14:10:08.281 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 1299.4941ms
2026-01-09 14:10:08.287 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 14:10:08.298 +02:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:cbc8c506-f50f-4796-8080-0424a3aa95de
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 21
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2026-01-09 14:10:08.405 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/3 - 500 null text/plain; charset=utf-8 1447.5389ms
2026-01-09 14:12:00.923 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 14:12:00.980 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 57.1653ms
2026-01-09 14:12:01.015 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 14:12:01.015 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 14:12:01.023 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 7.6849ms
2026-01-09 14:12:01.068 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 53.5366ms
2026-01-09 14:12:01.165 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 14:12:01.189 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 24.4448ms
2026-01-09 14:31:26.499 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 14:31:27.182 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 14:31:27.687 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 14:31:27.690 +02:00 [INF] Hosting environment: Development
2026-01-09 14:31:27.694 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 14:31:28.663 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 14:31:29.184 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 537.6922ms
2026-01-09 14:31:29.193 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 14:31:29.219 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 14:31:29.250 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 31.8692ms
2026-01-09 14:31:29.298 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 106.9467ms
2026-01-09 14:31:29.371 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 14:31:29.406 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 35.0579ms
2026-01-09 14:32:13.337 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category/10 - null null
2026-01-09 14:32:13.512 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:32:13.579 +02:00 [INF] Route matched with {action = "GetById", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:32:14.341 +02:00 [INF] Fetching category with ID 10...
2026-01-09 14:32:17.709 +02:00 [INF] Executed DbCommand (129ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 14:32:17.768 +02:00 [WRN] Category with ID 10 not found.
2026-01-09 14:32:17.791 +02:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 14:32:17.821 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone) in 4230.2351ms
2026-01-09 14:32:17.827 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:32:17.846 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category/10 - 404 null application/json; charset=utf-8 4508.8247ms
2026-01-09 14:32:26.198 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Category/19 - null null
2026-01-09 14:32:26.209 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:32:26.215 +02:00 [INF] Route matched with {action = "GetById", controller = "Category"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(Int32) on controller AmazonClone.API.Controllers.CategoryController (AmazonClone).
2026-01-09 14:32:26.226 +02:00 [INF] Fetching category with ID 19...
2026-01-09 14:32:26.359 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Name], [c].[ParentCategoryId], [c].[Status]
FROM [Categories] AS [c]
WHERE [c].[Id] = @__id_0
2026-01-09 14:32:26.421 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CategoryDto'.
2026-01-09 14:32:26.445 +02:00 [INF] Executed action AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone) in 225.3559ms
2026-01-09 14:32:26.449 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CategoryController.GetById (AmazonClone)'
2026-01-09 14:32:26.453 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Category/19 - 200 null application/json; charset=utf-8 255.8258ms
2026-01-09 14:33:24.699 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Auth/login - application/json 61
2026-01-09 14:33:24.711 +02:00 [INF] Executing endpoint 'AuthController.Login (AmazonClone)'
2026-01-09 14:33:24.723 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(Bl.DTOs.LoginUserDto) on controller AuthController (AmazonClone).
2026-01-09 14:33:25.273 +02:00 [INF] User attempting login with email ahmed123@gmail.com.
2026-01-09 14:33:25.415 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[ConfirmPassword], [u].[CreatedAt], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[Status]
FROM [Users] AS [u]
2026-01-09 14:33:25.430 +02:00 [WRN] Login failed for email ahmed123@gmail.com: Invalid credentials.
2026-01-09 14:33:25.607 +02:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 14:33:25.611 +02:00 [INF] Executed action AuthController.Login (AmazonClone) in 882.4355ms
2026-01-09 14:33:25.613 +02:00 [INF] Executed endpoint 'AuthController.Login (AmazonClone)'
2026-01-09 14:33:25.618 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Auth/login - 400 null application/json; charset=utf-8 918.5279ms
2026-01-09 14:33:37.211 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Auth/login - application/json 61
2026-01-09 14:33:37.218 +02:00 [INF] Executing endpoint 'AuthController.Login (AmazonClone)'
2026-01-09 14:33:37.239 +02:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(Bl.DTOs.LoginUserDto) on controller AuthController (AmazonClone).
2026-01-09 14:33:37.250 +02:00 [INF] User attempting login with email Ahmed123@gmail.com.
2026-01-09 14:33:37.262 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [u].[Id], [u].[ConfirmPassword], [u].[CreatedAt], [u].[Email], [u].[FirstName], [u].[LastName], [u].[PasswordHash], [u].[Status]
FROM [Users] AS [u]
2026-01-09 14:33:37.952 +02:00 [INF] User 4 logged in successfully.
2026-01-09 14:33:37.956 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.AuthResponseDto'.
2026-01-09 14:33:37.962 +02:00 [INF] Executed action AuthController.Login (AmazonClone) in 715.5141ms
2026-01-09 14:33:37.965 +02:00 [INF] Executed endpoint 'AuthController.Login (AmazonClone)'
2026-01-09 14:33:37.967 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Auth/login - 200 null application/json; charset=utf-8 756.3482ms
2026-01-09 14:33:47.435 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 14:33:47.477 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 44.9221ms
2026-01-09 14:33:47.513 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 14:33:47.513 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 14:33:47.522 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 8.796ms
2026-01-09 14:33:47.552 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.1118ms
2026-01-09 14:33:47.646 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 14:33:47.669 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 22.7313ms
2026-01-09 15:04:57.307 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 15:04:57.887 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 15:04:58.175 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 15:04:58.179 +02:00 [INF] Hosting environment: Development
2026-01-09 15:04:58.182 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 15:04:59.984 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 15:05:00.502 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 547.2134ms
2026-01-09 15:05:00.511 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 15:05:00.516 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 15:05:00.533 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 16.5641ms
2026-01-09 15:05:00.594 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 85.5104ms
2026-01-09 15:05:00.664 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:05:00.723 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 59.3402ms
2026-01-09 15:06:14.145 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:06:14.208 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 63.2735ms
2026-01-09 15:06:14.285 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/favicon.ico - null null
2026-01-09 15:06:14.441 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/favicon.ico - 404 0 null 155.936ms
2026-01-09 15:06:14.453 +02:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5114/favicon.ico, Response status code: 404
2026-01-09 15:52:46.677 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 15:52:47.943 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 15:52:48.505 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 15:52:48.508 +02:00 [INF] Hosting environment: Development
2026-01-09 15:52:48.510 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 15:52:52.539 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 15:52:53.310 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 825.2474ms
2026-01-09 15:52:53.364 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 15:52:53.382 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 19.6442ms
2026-01-09 15:52:53.462 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 15:52:53.792 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 330.6281ms
2026-01-09 15:52:53.985 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:52:54.057 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 72.0985ms
2026-01-09 15:53:31.713 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 41
2026-01-09 15:53:31.892 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:53:31.957 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 15:53:31.983 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 13.7005ms
2026-01-09 15:53:31.989 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:53:32.080 +02:00 [ERR] An unhandled exception occurred.
System.InvalidOperationException: Unable to resolve service for type 'Bl.Contracts.IPaymentService' while attempting to activate 'AmazonClone.API.Controllers.PaymentController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method9(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 15:53:32.169 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 455.3772ms
2026-01-09 15:53:49.942 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 41
2026-01-09 15:53:49.986 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:53:50.038 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 15:53:50.043 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 1.7082ms
2026-01-09 15:53:50.048 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:53:50.083 +02:00 [ERR] An unhandled exception occurred.
System.InvalidOperationException: Unable to resolve service for type 'Bl.Contracts.IPaymentService' while attempting to activate 'AmazonClone.API.Controllers.PaymentController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method9(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResourceFilter>g__Awaited|25_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResourceExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeFilterPipelineAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 15:53:50.097 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 154.9465ms
2026-01-09 15:56:07.667 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 15:56:07.696 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 28.6671ms
2026-01-09 15:56:07.748 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 15:56:07.748 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 15:56:07.756 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 8.7774ms
2026-01-09 15:56:07.779 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.1435ms
2026-01-09 15:56:08.038 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:56:08.075 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 36.1697ms
2026-01-09 15:56:22.835 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 15:56:23.317 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 15:56:23.831 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 15:56:23.834 +02:00 [INF] Hosting environment: Development
2026-01-09 15:56:23.836 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 15:56:25.025 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 15:56:25.450 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 443.0664ms
2026-01-09 15:56:25.454 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 15:56:25.467 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 15:56:25.492 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 24.5626ms
2026-01-09 15:56:25.533 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.1139ms
2026-01-09 15:56:25.768 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:56:25.824 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 55.7379ms
2026-01-09 15:56:55.743 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 41
2026-01-09 15:56:55.925 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:56:55.984 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 15:56:56.014 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 16.7253ms
2026-01-09 15:56:56.020 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:56:56.078 +02:00 [ERR] An unhandled exception occurred.
System.InvalidOperationException: Unable to resolve service for type 'Bl.Contracts.IPaymentService' while attempting to activate 'AmazonClone.API.Controllers.PaymentController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method9(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 15:56:56.157 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 414.2639ms
2026-01-09 15:58:13.555 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 15:58:14.052 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 15:58:14.637 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 15:58:14.640 +02:00 [INF] Hosting environment: Development
2026-01-09 15:58:14.645 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 15:58:15.301 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 15:58:15.757 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 473.7198ms
2026-01-09 15:58:15.766 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 15:58:15.777 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 15:58:15.794 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 16.9135ms
2026-01-09 15:58:15.839 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 77.099ms
2026-01-09 15:58:15.919 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 15:58:15.979 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 59.8917ms
2026-01-09 15:58:40.375 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 42
2026-01-09 15:58:40.517 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:58:40.570 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 15:58:43.114 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 2531.9913ms
2026-01-09 15:58:43.119 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:58:43.263 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid API Key provided: sk_test_************XXXX
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 24
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 15:58:43.426 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 3050.9403ms
2026-01-09 15:59:35.318 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 42
2026-01-09 15:59:35.332 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:59:35.369 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 15:59:35.915 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 541.0379ms
2026-01-09 15:59:35.920 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 15:59:36.014 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid API Key provided: sk_test_************XXXX
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 24
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 15:59:36.029 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 711.6226ms
2026-01-09 16:05:43.757 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 16:05:44.128 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 16:05:44.589 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 16:05:44.592 +02:00 [INF] Hosting environment: Development
2026-01-09 16:05:44.594 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 16:05:45.589 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:05:46.065 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 490.0654ms
2026-01-09 16:05:46.071 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:05:46.078 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:05:46.092 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 13.0609ms
2026-01-09 16:05:46.143 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 73.5613ms
2026-01-09 16:05:46.217 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:05:46.277 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 60.2228ms
2026-01-09 16:06:15.715 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 42
2026-01-09 16:06:15.905 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:06:15.955 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:06:17.386 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 1419.8061ms
2026-01-09 16:06:17.391 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:06:17.511 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid API Key provided: sk_test_***********************xxxx
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 24
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:06:17.599 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 1884.642ms
2026-01-09 16:15:50.310 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 16:15:50.559 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 16:15:50.766 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 16:15:50.767 +02:00 [INF] Hosting environment: Development
2026-01-09 16:15:50.767 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 16:15:52.412 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:15:52.666 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 264.4541ms
2026-01-09 16:15:52.670 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:15:52.673 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:15:52.679 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 6.6477ms
2026-01-09 16:15:52.706 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.6148ms
2026-01-09 16:15:52.743 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:15:52.768 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 25.1665ms
2026-01-09 16:16:02.346 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 38
2026-01-09 16:16:02.427 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:16:02.456 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:16:03.467 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 1006.6442ms
2026-01-09 16:16:03.470 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:16:03.534 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid API Key provided: sk_test_***********************xxxx
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 23
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:16:03.599 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 1252.9525ms
2026-01-09 16:16:18.985 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 47
2026-01-09 16:16:18.993 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:16:19.002 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:16:19.197 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 192.9471ms
2026-01-09 16:16:19.198 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:16:19.233 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid API Key provided: sk_test_***********************xxxx
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 23
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:16:19.239 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 253.9688ms
2026-01-09 16:16:38.624 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json - null null
2026-01-09 16:16:38.629 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json - 404 0 null 5.3343ms
2026-01-09 16:16:38.633 +02:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET http://localhost:5114/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2026-01-09 16:16:44.629 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Payment/create-payment-intent - null null
2026-01-09 16:16:44.640 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2026-01-09 16:16:44.642 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2026-01-09 16:16:44.643 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Payment/create-payment-intent - 405 0 null 14.4051ms
2026-01-09 16:21:17.885 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 16:21:18.074 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 16:21:18.247 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 16:21:18.248 +02:00 [INF] Hosting environment: Development
2026-01-09 16:21:18.249 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 16:21:20.532 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:21:20.770 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 249.3064ms
2026-01-09 16:21:20.774 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:21:20.777 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:21:20.783 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 9.1229ms
2026-01-09 16:21:20.814 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.4ms
2026-01-09 16:21:20.852 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:21:20.879 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 27.0424ms
2026-01-09 16:21:44.339 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 43
2026-01-09 16:21:44.403 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:21:44.421 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:21:45.438 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:21:45.446 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 1020.509ms
2026-01-09 16:21:45.448 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:21:45.450 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 200 null application/json; charset=utf-8 1111.5351ms
2026-01-09 16:34:09.522 +02:00 [INF] User profile is available. Using 'C:\Users\Ahmed Abdelbaset\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2026-01-09 16:34:09.778 +02:00 [INF] Now listening on: http://localhost:5114
2026-01-09 16:34:09.950 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2026-01-09 16:34:09.951 +02:00 [INF] Hosting environment: Development
2026-01-09 16:34:09.951 +02:00 [INF] Content root path: D:\AmazonClone\AmazonClone
2026-01-09 16:34:10.937 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:34:11.167 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 244.9798ms
2026-01-09 16:34:11.168 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:34:11.173 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:34:11.184 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 11.3988ms
2026-01-09 16:34:11.208 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.8643ms
2026-01-09 16:34:11.248 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:34:11.272 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 24.0262ms
2026-01-09 16:34:39.646 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Order/10 - null null
2026-01-09 16:34:39.717 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:34:39.743 +02:00 [INF] Route matched with {action = "GetOrdersForUser", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetOrdersForUser(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:34:40.072 +02:00 [INF] Fetching orders for user 10.
2026-01-09 16:34:41.454 +02:00 [INF] Executed DbCommand (69ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[Status], [o].[TotalAmount], [o].[UserId]
FROM [Orders] AS [o]
2026-01-09 16:34:41.506 +02:00 [INF] Fetched 0 orders for user 10.
2026-01-09 16:34:41.517 +02:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:34:41.528 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone) in 1780.2306ms
2026-01-09 16:34:41.530 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:34:41.540 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Order/10 - 404 null application/json; charset=utf-8 1893.8536ms
2026-01-09 16:34:58.154 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Order/1 - null null
2026-01-09 16:34:58.158 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:34:58.159 +02:00 [INF] Route matched with {action = "GetOrdersForUser", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetOrdersForUser(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:34:58.162 +02:00 [INF] Fetching orders for user 1.
2026-01-09 16:34:58.207 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[Status], [o].[TotalAmount], [o].[UserId]
FROM [Orders] AS [o]
2026-01-09 16:34:58.364 +02:00 [INF] Executed DbCommand (27ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:34:58.410 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:34:58.419 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:34:58.425 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:34:58.428 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:34:58.431 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:34:58.433 +02:00 [INF] Fetched 3 orders for user 1.
2026-01-09 16:34:58.434 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.OrderDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 16:34:58.447 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone) in 287.0094ms
2026-01-09 16:34:58.449 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:34:58.450 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Order/1 - 200 null application/json; charset=utf-8 296.2294ms
2026-01-09 16:36:35.540 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 59
2026-01-09 16:36:35.544 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:36:35.549 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:36:36.518 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 966.4492ms
2026-01-09 16:36:36.520 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:36:36.572 +02:00 [ERR] An unhandled exception occurred.
Stripe.StripeException: Invalid currency: str. Stripe currently supports these currencies: usd, aed, afn, all, amd, ang, aoa, ars, aud, awg, azn, bam, bbd, bdt, bgn, bhd, bif, bmd, bnd, bob, brl, bsd, bwp, byn, bzd, cad, cdf, chf, clp, cny, cop, crc, cve, czk, djf, dkk, dop, dzd, egp, etb, eur, fjd, fkp, gbp, gel, gip, gmd, gnf, gtq, gyd, hkd, hnl, hrk, htg, huf, idr, ils, inr, isk, jmd, jod, jpy, kes, kgs, khr, kmf, krw, kwd, kyd, kzt, lak, lbp, lkr, lrd, lsl, mad, mdl, mga, mkd, mmk, mnt, mop, mur, mvr, mwk, mxn, myr, mzn, nad, ngn, nio, nok, npr, nzd, omr, pab, pen, pgk, php, pkr, pln, pyg, qar, ron, rsd, rub, rwf, sar, sbd, scr, sek, sgd, shp, sle, sos, srd, std, szl, thb, tjs, tnd, top, try, ttd, twd, tzs, uah, ugx, uyu, uzs, vnd, vuv, wst, xaf, xcd, xcg, xof, xpf, yer, zar, zmw, usdc, btn, ghs, eek, lvl, svc, vef, ltl, sll, mro
   at Stripe.LiveApiRequestor.ProcessResponse[T](StripeResponse response, ApiMode apiMode) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 259
   at Stripe.LiveApiRequestor.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Infrastructure/Public/LiveApiRequestor.cs:line 113
   at Stripe.Service.RequestAsync[T](BaseAddress baseAddress, HttpMethod method, String path, BaseOptions options, RequestOptions requestOptions, CancellationToken cancellationToken) in /_/src/Stripe.net/Services/_base/Service.cs:line 100
   at PaymentService.CreatePaymentIntentAsync(Decimal amount, String currency, Int32 orderId) in D:\AmazonClone\Bl\Services\PaymentService.cs:line 30
   at AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent(CreatePaymentIntentDto dto) in D:\AmazonClone\AmazonClone\Controllers\PaymentController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:36:36.622 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 400 null application/json 1081.5612ms
2026-01-09 16:36:59.644 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 59
2026-01-09 16:36:59.650 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:36:59.651 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:37:00.172 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:37:00.175 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 522.0553ms
2026-01-09 16:37:00.176 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:37:00.177 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 200 null application/json; charset=utf-8 533.3122ms
2026-01-09 16:43:48.131 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:43:48.150 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 19.2346ms
2026-01-09 16:43:48.164 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:43:48.164 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:43:48.173 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 7.3005ms
2026-01-09 16:43:48.178 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 14.3357ms
2026-01-09 16:43:48.300 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:43:48.320 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 20.1863ms
2026-01-09 16:43:56.212 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/1 - null null
2026-01-09 16:43:56.215 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:43:56.220 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:43:56.226 +02:00 [INF] Fetching cart for user 1.
2026-01-09 16:43:56.422 +02:00 [INF] Executed DbCommand (48ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:43:56.475 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CartDto'.
2026-01-09 16:43:56.478 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 256.6399ms
2026-01-09 16:43:56.479 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:43:56.481 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/1 - 200 null application/json; charset=utf-8 269.2031ms
2026-01-09 16:44:05.416 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/2 - null null
2026-01-09 16:44:05.419 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:05.420 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:44:05.423 +02:00 [INF] Fetching cart for user 2.
2026-01-09 16:44:05.427 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:44:05.429 +02:00 [INF] Creating new cart for user 2.
2026-01-09 16:44:05.558 +02:00 [INF] Executed DbCommand (39ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:44:05.582 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 16:44:05.718 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 295.8961ms
2026-01-09 16:44:05.720 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:05.758 +02:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:44:05.770 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/2 - 400 null application/json 354.0926ms
2026-01-09 16:44:14.584 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/3 - null null
2026-01-09 16:44:14.587 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:14.588 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:44:14.592 +02:00 [INF] Fetching cart for user 3.
2026-01-09 16:44:14.601 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:44:14.603 +02:00 [INF] Creating new cart for user 3.
2026-01-09 16:44:14.609 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:44:14.614 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 16:44:14.747 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 157.3164ms
2026-01-09 16:44:14.749 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:14.788 +02:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:44:14.797 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/3 - 400 null application/json 213.0348ms
2026-01-09 16:44:19.561 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/1 - null null
2026-01-09 16:44:19.563 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:19.564 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:44:19.567 +02:00 [INF] Fetching cart for user 1.
2026-01-09 16:44:19.575 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:44:19.579 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CartDto'.
2026-01-09 16:44:19.580 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 14.0465ms
2026-01-09 16:44:19.581 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:44:19.582 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/1 - 200 null application/json; charset=utf-8 21.5418ms
2026-01-09 16:44:42.482 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:44:42.493 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 11.2364ms
2026-01-09 16:44:42.503 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:44:42.504 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:44:42.510 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 4.0134ms
2026-01-09 16:44:42.525 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 22.4112ms
2026-01-09 16:44:42.624 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:44:42.636 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 11.9321ms
2026-01-09 16:44:50.730 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/index.html - null null
2026-01-09 16:44:50.735 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/index.html - 200 null text/html;charset=utf-8 5.5883ms
2026-01-09 16:44:50.747 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - null null
2026-01-09 16:44:50.747 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/_vs/browserLink - null null
2026-01-09 16:44:50.749 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_framework/aspnetcore-browser-refresh.js - 200 16507 application/javascript; charset=utf-8 2.5162ms
2026-01-09 16:44:50.755 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/_vs/browserLink - 200 null text/javascript; charset=UTF-8 8.7117ms
2026-01-09 16:44:50.780 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - null null
2026-01-09 16:44:50.791 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 11.1826ms
2026-01-09 16:45:04.233 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Order/1 - null null
2026-01-09 16:45:04.235 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:45:04.236 +02:00 [INF] Route matched with {action = "GetOrdersForUser", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetOrdersForUser(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:45:04.239 +02:00 [INF] Fetching orders for user 1.
2026-01-09 16:45:04.243 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[Status], [o].[TotalAmount], [o].[UserId]
FROM [Orders] AS [o]
2026-01-09 16:45:04.248 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:45:04.252 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:45:04.255 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:45:04.258 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:45:04.260 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:45:04.263 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:45:04.265 +02:00 [INF] Fetched 3 orders for user 1.
2026-01-09 16:45:04.266 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.OrderDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 16:45:04.267 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone) in 29.8111ms
2026-01-09 16:45:04.269 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:45:04.270 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Order/1 - 200 null application/json; charset=utf-8 37.1058ms
2026-01-09 16:46:08.956 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/1 - null null
2026-01-09 16:46:08.963 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:08.964 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:46:08.966 +02:00 [INF] Fetching cart for user 1.
2026-01-09 16:46:08.975 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:46:08.977 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CartDto'.
2026-01-09 16:46:08.979 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 13.5876ms
2026-01-09 16:46:08.980 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:08.981 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/1 - 200 null application/json; charset=utf-8 24.9551ms
2026-01-09 16:46:15.892 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/2 - null null
2026-01-09 16:46:15.895 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:15.896 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:46:15.899 +02:00 [INF] Fetching cart for user 2.
2026-01-09 16:46:15.905 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:46:15.907 +02:00 [INF] Creating new cart for user 2.
2026-01-09 16:46:15.911 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:46:15.916 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 16:46:16.021 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 122.1781ms
2026-01-09 16:46:16.023 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:16.063 +02:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:46:16.072 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/2 - 400 null application/json 179.6339ms
2026-01-09 16:46:21.276 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/3 - null null
2026-01-09 16:46:21.279 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:21.280 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:46:21.282 +02:00 [INF] Fetching cart for user 3.
2026-01-09 16:46:21.287 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:46:21.292 +02:00 [INF] Creating new cart for user 3.
2026-01-09 16:46:21.294 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:46:21.299 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 16:46:21.406 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 124.592ms
2026-01-09 16:46:21.408 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:46:21.445 +02:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:46:21.456 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/3 - 400 null application/json 179.8602ms
2026-01-09 16:47:00.192 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=14&quantity=1 - null 0
2026-01-09 16:47:00.199 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:00.203 +02:00 [INF] Route matched with {action = "AddProduct", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddProduct(Int32, Int32, Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:47:00.211 +02:00 [INF] Adding product 14 (Qty: 1) to cart for user 4.
2026-01-09 16:47:00.220 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:47:00.222 +02:00 [INF] Creating new cart for user 4.
2026-01-09 16:47:00.226 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:47:00.250 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 16:47:00.252 +02:00 [ERR] Product with ID 14 not found.
2026-01-09 16:47:00.292 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone) in 87.9035ms
2026-01-09 16:47:00.294 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:00.322 +02:00 [ERR] An unhandled exception occurred.
System.Exception: Product with ID 14 not found
   at Bl.Services.CartService.AddProductAsync(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\Bl\Services\CartService.cs:line 54
   at AmazonClone.API.Controllers.CartController.AddProduct(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 43
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:47:00.327 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=14&quantity=1 - 400 null application/json 135.632ms
2026-01-09 16:47:06.832 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=19&quantity=1 - null 0
2026-01-09 16:47:06.835 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:06.836 +02:00 [INF] Route matched with {action = "AddProduct", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddProduct(Int32, Int32, Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:47:06.839 +02:00 [INF] Adding product 19 (Qty: 1) to cart for user 4.
2026-01-09 16:47:06.851 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:47:06.855 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 16:47:06.860 +02:00 [ERR] Product with ID 19 not found.
2026-01-09 16:47:06.890 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone) in 51.1695ms
2026-01-09 16:47:06.892 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:06.922 +02:00 [ERR] An unhandled exception occurred.
System.Exception: Product with ID 19 not found
   at Bl.Services.CartService.AddProductAsync(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\Bl\Services\CartService.cs:line 54
   at AmazonClone.API.Controllers.CartController.AddProduct(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 43
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:47:06.927 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=19&quantity=1 - 400 null application/json 94.2592ms
2026-01-09 16:47:11.270 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=26&quantity=1 - null 0
2026-01-09 16:47:11.273 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:11.274 +02:00 [INF] Route matched with {action = "AddProduct", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddProduct(Int32, Int32, Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:47:11.277 +02:00 [INF] Adding product 26 (Qty: 1) to cart for user 4.
2026-01-09 16:47:11.289 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:47:11.293 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 16:47:11.295 +02:00 [ERR] Product with ID 26 not found.
2026-01-09 16:47:11.327 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone) in 50.8646ms
2026-01-09 16:47:11.329 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:11.361 +02:00 [ERR] An unhandled exception occurred.
System.Exception: Product with ID 26 not found
   at Bl.Services.CartService.AddProductAsync(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\Bl\Services\CartService.cs:line 54
   at AmazonClone.API.Controllers.CartController.AddProduct(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 43
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:47:11.366 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=26&quantity=1 - 400 null application/json 96.1415ms
2026-01-09 16:47:20.140 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=4&quantity=1 - null 0
2026-01-09 16:47:20.143 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:20.143 +02:00 [INF] Route matched with {action = "AddProduct", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddProduct(Int32, Int32, Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:47:20.145 +02:00 [INF] Adding product 4 (Qty: 1) to cart for user 4.
2026-01-09 16:47:20.153 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:47:20.157 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 16:47:20.159 +02:00 [ERR] Product with ID 4 not found.
2026-01-09 16:47:20.192 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone) in 46.9757ms
2026-01-09 16:47:20.194 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:20.223 +02:00 [ERR] An unhandled exception occurred.
System.Exception: Product with ID 4 not found
   at Bl.Services.CartService.AddProductAsync(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\Bl\Services\CartService.cs:line 54
   at AmazonClone.API.Controllers.CartController.AddProduct(Int32 userId, Int32 productId, Int32 quantity) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 43
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:47:20.228 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=4&quantity=1 - 400 null application/json 87.591ms
2026-01-09 16:47:28.261 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Product - null null
2026-01-09 16:47:28.264 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 16:47:28.267 +02:00 [INF] Route matched with {action = "GetAll", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetAll() on controller AmazonClone.API.Controllers.ProductController (AmazonClone).
2026-01-09 16:47:28.270 +02:00 [INF] Fetching all products...
2026-01-09 16:47:28.279 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
2026-01-09 16:47:28.282 +02:00 [INF] Fetched 2 products.
2026-01-09 16:47:28.283 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.ProductDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 16:47:28.286 +02:00 [INF] Executed action AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone) in 17.4725ms
2026-01-09 16:47:28.287 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.ProductController.GetAll (AmazonClone)'
2026-01-09 16:47:28.288 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Product - 200 null application/json; charset=utf-8 26.9687ms
2026-01-09 16:47:45.446 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=2&quantity=1 - null 0
2026-01-09 16:47:45.449 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:45.450 +02:00 [INF] Route matched with {action = "AddProduct", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddProduct(Int32, Int32, Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:47:45.457 +02:00 [INF] Adding product 2 (Qty: 1) to cart for user 4.
2026-01-09 16:47:45.467 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:47:45.479 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__id_0
2026-01-09 16:47:45.482 +02:00 [INF] Product 2 added to cart.
2026-01-09 16:47:45.564 +02:00 [INF] Executed DbCommand (22ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p12='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime2), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = Int32), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [CartItems] ([CartId], [CreatedAt], [ProductId], [Quantity], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
UPDATE [Products] SET [CategoryId] = @p5, [CreatedAt] = @p6, [Description] = @p7, [Name] = @p8, [Price] = @p9, [Status] = @p10, [StockQuantity] = @p11
OUTPUT 1
WHERE [Id] = @p12;
2026-01-09 16:47:45.578 +02:00 [INF] Executing StatusCodeResult, setting HTTP status code 200
2026-01-09 16:47:45.579 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone) in 123.0115ms
2026-01-09 16:47:45.580 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.AddProduct (AmazonClone)'
2026-01-09 16:47:45.581 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/cart/4/add?productId=2&quantity=1 - 200 0 null 135.3825ms
2026-01-09 16:48:14.925 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/3 - null null
2026-01-09 16:48:14.932 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:48:14.934 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:48:14.936 +02:00 [INF] Fetching cart for user 3.
2026-01-09 16:48:14.953 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:48:14.955 +02:00 [INF] Creating new cart for user 3.
2026-01-09 16:48:14.959 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Carts] ([CreatedAt], [Status], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2);
2026-01-09 16:48:14.964 +02:00 [ERR] An exception occurred in the database while saving changes for context type 'DAL.Dbcontext.AmazonCloneContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2026-01-09 16:48:15.066 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 131.0185ms
2026-01-09 16:48:15.068 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:48:15.113 +02:00 [ERR] An unhandled exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Carts_Users_UserId". The conflict occurred in database "AmazonClone", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:1747f80d-6a0d-4400-a38e-82a6cffd5393
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at DAL.Repositories.GenericRepository`1.AddAsync(T entity) in D:\AmazonClone\DAL\Repositories\GenericRepository.cs:line 60
   at Bl.Services.CartService.GetOrCreateCart(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 118
   at Bl.Services.CartService.GetUserCartAsync(Int32 userId) in D:\AmazonClone\Bl\Services\CartService.cs:line 31
   at AmazonClone.API.Controllers.CartController.GetCart(Int32 userId) in D:\AmazonClone\AmazonClone\Controllers\CartController.cs:line 29
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at AmazonClone.API.Middlewares.ExceptionMiddleware.InvokeAsync(HttpContext context) in D:\AmazonClone\AmazonClone\Middlewares\ExceptionMiddleware.cs:line 25
2026-01-09 16:48:15.123 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/3 - 400 null application/json 198.3534ms
2026-01-09 16:48:19.472 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/cart/4 - null null
2026-01-09 16:48:19.475 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:48:19.476 +02:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetCart(Int32) on controller AmazonClone.API.Controllers.CartController (AmazonClone).
2026-01-09 16:48:19.478 +02:00 [INF] Fetching cart for user 4.
2026-01-09 16:48:19.488 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:48:19.494 +02:00 [INF] Executing OkObjectResult, writing value of type 'Bl.DTOs.CartDto'.
2026-01-09 16:48:19.495 +02:00 [INF] Executed action AmazonClone.API.Controllers.CartController.GetCart (AmazonClone) in 17.3838ms
2026-01-09 16:48:19.497 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.CartController.GetCart (AmazonClone)'
2026-01-09 16:48:19.498 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/cart/4 - 200 null application/json; charset=utf-8 25.1796ms
2026-01-09 16:48:36.346 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Order/4 - null null
2026-01-09 16:48:36.348 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:48:36.349 +02:00 [INF] Route matched with {action = "GetOrdersForUser", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetOrdersForUser(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:48:36.356 +02:00 [INF] Fetching orders for user 4.
2026-01-09 16:48:36.362 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[Status], [o].[TotalAmount], [o].[UserId]
FROM [Orders] AS [o]
2026-01-09 16:48:36.368 +02:00 [INF] Fetched 0 orders for user 4.
2026-01-09 16:48:36.370 +02:00 [INF] Executing NotFoundObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:48:36.371 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone) in 15.3536ms
2026-01-09 16:48:36.373 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:48:36.374 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Order/4 - 404 null application/json; charset=utf-8 28.0355ms
2026-01-09 16:48:50.178 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Order/checkout/4 - null 0
2026-01-09 16:48:50.181 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.Checkout (AmazonClone)'
2026-01-09 16:48:50.186 +02:00 [INF] Route matched with {action = "Checkout", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Checkout(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:48:50.192 +02:00 [INF] User 4 is attempting to checkout.
2026-01-09 16:48:50.200 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [c1].[Id], [c1].[CreatedAt], [c1].[Status], [c1].[UserId], [s].[Id], [s].[CartId], [s].[CreatedAt], [s].[ProductId], [s].[Quantity], [s].[Status], [s].[Id0], [s].[CategoryId], [s].[CreatedAt0], [s].[Description], [s].[Name], [s].[Price], [s].[Status0], [s].[StockQuantity]
FROM (
    SELECT TOP(1) [c].[Id], [c].[CreatedAt], [c].[Status], [c].[UserId]
    FROM [Carts] AS [c]
    WHERE [c].[UserId] = @__userId_0
) AS [c1]
LEFT JOIN (
    SELECT [c0].[Id], [c0].[CartId], [c0].[CreatedAt], [c0].[ProductId], [c0].[Quantity], [c0].[Status], [p].[Id] AS [Id0], [p].[CategoryId], [p].[CreatedAt] AS [CreatedAt0], [p].[Description], [p].[Name], [p].[Price], [p].[Status] AS [Status0], [p].[StockQuantity]
    FROM [CartItems] AS [c0]
    INNER JOIN [Products] AS [p] ON [c0].[ProductId] = [p].[Id]
) AS [s] ON [c1].[Id] = [s].[CartId]
ORDER BY [c1].[Id], [s].[Id]
2026-01-09 16:48:50.237 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Orders] ([CreatedAt], [Status], [TotalAmount], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2026-01-09 16:48:50.245 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[@p4='?' (DbType = DateTime2), @p5='?' (DbType = Int32), @p6='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [OrderItems] ([CreatedAt], [OrderId], [Price], [ProductId], [Quantity], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p4, @p5, @p6, @p7, @p8, @p9);
2026-01-09 16:48:50.262 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
DELETE FROM [CartItems]
OUTPUT 1
WHERE [Id] = @p0;
2026-01-09 16:48:50.267 +02:00 [INF] Order 4 created successfully for user 4 with total amount 30000.00.
2026-01-09 16:48:50.268 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType2`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:48:50.270 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.Checkout (AmazonClone) in 82.1479ms
2026-01-09 16:48:50.271 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.Checkout (AmazonClone)'
2026-01-09 16:48:50.272 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Order/checkout/4 - 200 null application/json; charset=utf-8 94.3241ms
2026-01-09 16:49:00.202 +02:00 [INF] Request starting HTTP/1.1 GET http://localhost:5114/api/Order/4 - null null
2026-01-09 16:49:00.205 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:49:00.206 +02:00 [INF] Route matched with {action = "GetOrdersForUser", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetOrdersForUser(Int32) on controller AmazonClone.API.Controllers.OrderController (AmazonClone).
2026-01-09 16:49:00.208 +02:00 [INF] Fetching orders for user 4.
2026-01-09 16:49:00.212 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[Status], [o].[TotalAmount], [o].[UserId]
FROM [Orders] AS [o]
2026-01-09 16:49:00.220 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [o].[Id], [o].[CreatedAt], [o].[OrderId], [o].[Price], [o].[ProductId], [o].[Quantity], [o].[Status]
FROM [OrderItems] AS [o]
WHERE [o].[OrderId] = @__p_0
2026-01-09 16:49:00.223 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [p].[Id], [p].[CategoryId], [p].[CreatedAt], [p].[Description], [p].[Name], [p].[Price], [p].[Status], [p].[StockQuantity]
FROM [Products] AS [p]
WHERE [p].[Id] = @__p_0
2026-01-09 16:49:00.225 +02:00 [INF] Fetched 1 orders for user 4.
2026-01-09 16:49:00.226 +02:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[Bl.DTOs.OrderDto, Bl, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2026-01-09 16:49:00.227 +02:00 [INF] Executed action AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone) in 19.5167ms
2026-01-09 16:49:00.228 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.OrderController.GetOrdersForUser (AmazonClone)'
2026-01-09 16:49:00.229 +02:00 [INF] Request finished HTTP/1.1 GET http://localhost:5114/api/Order/4 - 200 null application/json; charset=utf-8 26.9583ms
2026-01-09 16:50:13.485 +02:00 [INF] Request starting HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - application/json 58
2026-01-09 16:50:13.500 +02:00 [INF] Executing endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:50:13.501 +02:00 [INF] Route matched with {action = "CreatePaymentIntent", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePaymentIntent(Bl.DTOs.CreatePaymentIntentDto) on controller AmazonClone.API.Controllers.PaymentController (AmazonClone).
2026-01-09 16:50:14.194 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType3`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2026-01-09 16:50:14.195 +02:00 [INF] Executed action AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone) in 692.6375ms
2026-01-09 16:50:14.197 +02:00 [INF] Executed endpoint 'AmazonClone.API.Controllers.PaymentController.CreatePaymentIntent (AmazonClone)'
2026-01-09 16:50:14.198 +02:00 [INF] Request finished HTTP/1.1 POST http://localhost:5114/api/Payment/create-payment-intent - 200 null application/json; charset=utf-8 712.9832ms
